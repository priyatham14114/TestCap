sap.ui.define(["./basecontroller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","../Secrets/Config","sap/ndc/BarcodeScanner","sap/ui/model/odata/v4/ODataModel","sap/ui/model/Sorter"],function(e,t,s,n,i,r,o,a,d,l,c){"use strict";return e.extend("com.app.parkingappl.controller.HomeView",{onInit:function(){},onBeforeRendering:function(){debugger;this.byId("parkingLotSelect").getBinding("items").sort(new sap.ui.model.Sorter("Slotnumbers"));this.updateSoltsStatusbyDate();var e=0;var t=this.getView().getModel("ModelV2");var s=this;t.read("/ZPARKING_RESERVE_SSet",{success:function(t){t.results.forEach(t=>{if(t.Reservedslot===""){e=e+1}});s.getView().byId("idbadghqwe").setValue(e)},error:function(e){}})},onEditPress:function(){debugger;var e=this.byId("idAssignedTable");var t=e.getSelectedItem();if(!t){r.show("Please select record to edit.");return}const s=t.getBindingContext().getObject(),n=s.Slotnumbers;t.getCells()[5].getItems()[0].setVisible(false);t.getCells()[5].getItems()[1].setVisible(true);this.byId("idBtnEdit").setVisible(false);this.byId("idBtnSave").setVisible(true);this.byId("idBtnCancel").setVisible(true);this.byId("idBtUnassign").setVisible(false)},onSavePress:function(){debugger;const e=this;var t=this.byId("idAssignedTable");var s=t.getSelectedItem(),n=s.getBindingContext().getObject();var i=this.getView().getModel("ModelV2");s.getCells()[5].getItems()[0].setVisible(true);s.getCells()[5].getItems()[1].setVisible(false);var o=s.getCells()[5].getItems()[0].getText();var a=s.getCells()[5].getItems()[1].getSelectedKey();const d={Status:"NOT AVAILABLE",Assigneddrivername:n.Assigneddrivername,Assigneddrivermobile:n.Assigneddrivermobile,Assignedvehiclenumber:n.Assignedvehiclenumber,Assigneddeliverytype:n.Assigneddeliverytype,VendorName:n.VendorName,Assignedcheckintime:n.Assignedcheckintime};const l={Status:"AVAILABLE",Assigneddrivername:"",Assigneddrivermobile:"",Assignedvehiclenumber:"",Assigneddeliverytype:"",VendorName:"",Assignedcheckintime:""};i.update(`/ZPARKING_SLOTS_SSet('${a}')`,d,{success:function(e,t){i.update(`/ZPARKING_SLOTS_SSet('${o}')`,l,{success:function(e,t){r.show("Slot Updated Successfully")},error:function(e){r.show("Error"+e.message)}});r.show("Slot Updated Successfully")},error:function(e){r.show("Error"+e.message)}});this.byId("idBtnSave").setVisible(false);this.byId("idBtnEdit").setVisible(true);this.byId("idBtnCancel").setVisible(false);this.byId("idBtUnassign").setVisible(true)},onCanclePress:function(){var e=this.byId("idAssignedTable");var t=e.getSelectedItems();t.forEach(function(e){var t=e.getCells();t.forEach(function(e){if(e.getId().includes("idinTablevbox")){var t=e.getItems();t[0].setVisible(true);t[1].setVisible(false)}})});this.byId("idBtnEdit").setVisible(true);this.byId("idBtnSave").setVisible(false);this.byId("idBtnCancel").setVisible(false);this.byId("idBtUnassign").setVisible(true)},onReservationsPress:async function(){var e=0;var t=this.getView().getModel("ModelV2");var s=this;t.read("/ZPARKING_RESERVE_SSet",{success:function(t){t.results.forEach(t=>{if(t.Reservedslot===""){e=e+1}});s.getView().byId("idbadghqwe").setValue(e)},error:function(e){}});if(!this.Reservationspopup){this.Reservationspopup=await this.loadFragment("Reservations")}this.Reservationspopup.open();t.refresh(true)},onCloseReservations:function(){if(this.Reservationspopup.isOpen()){this.Reservationspopup.close();const e=this.getView().getModel("ModelV2");e.refresh()}},onSearch:function(e){debugger;var t=[];var s=e.getSource().getValue();if(s&&s.length>0){var r=new n("Assignedvehiclenumber",i.Contains,s);var o=new n("Slotnumbers",i.Contains,s);var a=new n("Assigneddrivername",i.Contains,s);var d=new n("Assigneddrivermobile",i.Contains,s);var l=new n("Assigneddeliverytype",i.Contains,s);var c=new n("VendorName",i.Contains,s);var u=new n({filters:[r,o,a,d,l,c],and:false});var g=new n("Assignedvehiclenumber",i.NE,"");var h=new n({filters:[u,g],and:true});t.push(h)}else{t.push(new n("Assignedvehiclenumber",i.NE,""))}var f=this.byId("idAssignedTable");var m=f.getBinding("items");m.filter(t)},onAssignPress:async function(e){debugger;var t=this;var s=new Date;var n=s.getFullYear();var i=s.getMonth()+1;var o=s.getDate();var a=s.getHours();var d=s.getMinutes();var l=s.getSeconds();var c=`${n}-${i}-${o} TIME ${a}:${d}:${l}`;const u=this.getView(),g=u.byId("idDriverName").getValue().toUpperCase(),h=u.byId("idDriverMobile").getValue().toUpperCase(),f=u.byId("idVehicleNUmber").getValue().toUpperCase(),m=u.byId("idVendorName___").getValue().toUpperCase(),S=u.byId("idTypeOfDelivery").getSelectedKey().toUpperCase(),b=u.byId("parkingLotSelect").getSelectedKey(),v=c;var I=this.byId("parkingLotSelect");var y=I.getSelectedItem();if(y){var p=y.getText()}const V={Status:"NOT AVAILABLE",Assigneddrivername:g,Assigneddrivermobile:h,Assignedvehiclenumber:f,Assigneddeliverytype:S,VendorName:m,Assignedcheckintime:v};const w=this.getView().getModel("MOdelV2");w.update(`/ZPARKING_SLOTS_SSet('${b}')`,V,{success:async function(e,t){r("Updated")},error:async function(e){r("failed to Updated")}})},closeReceiptDailog:function(){if(this.ReceiptDailog.isOpen()){this.ReceiptDailog.close()}},onUnassignPress:function(e){debugger;const t=this;const s=this.getView().getModel("ModelV2");var n=this.byId("idAssignedTable").getSelectedItem();if(n){var i=n.getBindingContext().getObject().Assignedvehiclenumber;var o=n.getBindingContext().getObject().Slotnumbers;var d=n.getBindingContext().getObject().Assigneddrivername;var l=n.getBindingContext().getObject().Deliverytype;var c=n.getBindingContext().getObject().Assigneddrivermobile;var u=n.getBindingContext().getObject().Assignedcheckintime;var g=n.getBindingContext().getObject().VendorName;var h=new Date;var f=h.getFullYear();var m=h.getMonth()+1;var S=h.getDate();var b=h.getHours();var v=h.getMinutes();var I=h.getSeconds();var y=`${f}-${m}-${S} TIME ${b}:${v}:${I}`;var p=y;function V(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,s=e=="x"?t:t&3|8;return s.toString(16)})}const w=V();const A={Status:"AVAILABLE",Assigneddrivername:"",Assigneddrivermobile:"",Assignedvehiclenumber:"",Assigneddeliverytype:"",VendorName:"",Assignedcheckintime:""};const _={Uuid:w,Drivername:d,Drivermobile:c,Vehiclenumber:i,Deliverytype:l,Checkintime:u,Historyslotnumber:o,VendorName:g,Checkouttime:p};s.update(`/ZPARKING_SLOTS_SSet('${o}')`,A,{success:async function(e,n){s.refresh(true);const o=a.twilio.accountSid;const l=a.twilio.authToken;const u=`+91${c}`;const g="+15856485867";const h=`Hi ${d} please move the vehicle from the parking yard.\nIgnore if already left from the yard.\nThank you,\nVishal Parking Management`;const f=`https://api.twilio.com/2010-04-01/Accounts/${o}/Messages.json`;$.ajax({url:f,type:"POST",headers:{Authorization:"Basic "+btoa(o+":"+l)},data:{To:u,From:g,Body:h},success:function(e){console.log("SMS sent successfully:",e);sap.m.MessageToast.show("SMS sent successfully!")},error:function(e){console.error("Error sending SMS:",e);sap.m.MessageToast.show("Failed to send SMS: "+e)}});var m=t.byId("movingImage2");m.setVisible(true);m.addStyleClass("animate");setTimeout(function(){m.setVisible(false)},7e3);s.create("/ZPARKING_HISTORYSet",_,{success:function(e,t){},error:function(e){r.show("Error"+e.message)}});t.getView().byId("idHistoryTable").getBinding("items").refresh();r.show("Vechicle "+i+" Unassigned Successfully")},error:function(e){}})}else{r.show("Please Select a record")}},onConfirmReservePress:async function(){debugger;if(!this.confirmDialog){this.confirmDialog=await this.loadFragment("confirmBookings")}const e=this.getView().byId("idReservationsTable").getSelectedItem();if(e){const i=e.getBindingContext().getObject(),r=i.Drivername,o=i.Drivermobile,a=i.Vehiclenumber,d=i.Vendorname;this.confirmDialog.open();this.byId("_IDGendfgdInput1").setValue(r);this.byId("_IDGexgrgnInput2").setValue(o);this.byId("idasgredhmeInput").setValue(a);this.byId("idasgredhmeIn0075put").setValue(d);debugger;var t=this.getView().byId("idDatePicker");var s=new Date;t.setMinDate(s);var n=new Date;n.setDate(n.getDate()+7);t.setMaxDate(n);this.getView().getModel("ModelV2").refresh()}else{r.show("Select a record to accept reservations")}},onCloseConfirmDialog:function(){if(this.confirmDialog.isOpen()){this.confirmDialog.close()}},onConfirmBookSlotPress:function(){debugger;let e=new Date;let t=e.getFullYear();let s=String(e.getMonth()+1).padStart(2,"0");let d=String(e.getDate()).padStart(2,"0");const l=`${t}-${s}-${d}`;const c=this;const u=this.getView().byId("_IDGendfgdInput1").getValue(),g=this.getView().byId("_IDGexgrgnInput2").getValue(),h=this.getView().byId("idasgredhmeInput").getValue(),f=this.getView().byId("idasgredhmeIn0075put").getValue(),m=this.getView().byId("idSlotReserve").getSelectedKey(),S=this.getView().byId("idDatePicker").getValue();var b=this.byId("idSlotReserve");var v=b.getSelectedItem();if(v){var I=v.getText()}const y=this.getView().byId("idReservationsTable").getSelectedItem().getBindingContext().getObject().Uuid;const p={Drivername:u,Drivermobile:g,Vehiclenumber:h,Vendorname:f,Reservedslot:m,Reserveddate:S};const V=this.getView().getModel("ModelV2"),w=this.getView();var A=true;if(!u||u.length<3||!/^[a-zA-Z\s]+$/.test(u)){w.byId("_IDGendfgdInput1").setValueState("Error");w.byId("_IDGendfgdInput1").setValueStateText("Name Must Contain 3 Characters A-Z or a-z");A=false}else{w.byId("_IDGendfgdInput1").setValueState("None")}if(!g||g.length!==10||!/^\d+$/.test(g)){w.byId("_IDGexgrgnInput2").setValueState("Error");w.byId("_IDGexgrgnInput2").setValueStateText("Mobile number must be a 10-digit numeric value");A=false}else{w.byId("_IDGexgrgnInput2").setValueState("None")}if(!h||!/^[A-Za-z]{2}\d{2}[A-Za-z]{2}\d{4}$/.test(h)){w.byId("idasgredhmeInput").setValueState("Error");w.byId("idasgredhmeInput").setValueStateText("Vehicle number should follow this pattern AP12BG1234");A=false}else{w.byId("idasgredhmeInput").setValueState("None")}if(!f||f.length<3||!/^[a-zA-Z\s]+$/.test(f)){w.byId("idasgredhmeIn0075put").setValueState("Error");w.byId("idasgredhmeIn0075put").setValueStateText("Vendor Name Must Contain 3 Characters A-Z or a-z");A=false}else{w.byId("idasgredhmeIn0075put").setValueState("None")}if(!S){w.byId("idDatePicker").setValueState("Error");w.byId("idDatePicker").setValueStateText("Select Date");A=false}else{w.byId("idDatePicker").setValueState("None")}if(!A){r.show("Please enter correct data");return}const _=new n("Reserveddate",i.EQ,S);const D=new n("Reservedslot",i.EQ,m);const x=new n("Slotnumbers",i.EQ,m);if(S===l){V.read("/ZPARKING_SLOTS_SSet",{filters:[x],success:function(e){if(e.results.length>0&&e.results[0].Status!=="AVAILABLE"){o.information("Selected slot not available Today")}else{V.update(`/ZPARKING_RESERVE_SSet('${y}')`,p,{success:async function(e,t){var s=0;var o=c.getView().getModel("ModelV2");o.read("/ZPARKING_RESERVE_SSet",{success:function(e){e.results.forEach(e=>{if(e.Reservedslot===""){s=s+1}});c.getView().byId("idbadghqwe").setValue(s)},error:function(e){}});const d=a.twilio.accountSid;const b=a.twilio.authToken;const v=`+91${g}`;const y="+15856485867";const p=`Hi ${u} a Slot number ${I} is reserved on your vehicle number ${h} \nVendor name: ${f}. \nThank You,\nVishal Parking Management`;const V=`https://api.twilio.com/2010-04-01/Accounts/${d}/Messages.json`;$.ajax({url:V,type:"POST",headers:{Authorization:"Basic "+btoa(d+":"+b)},data:{To:v,From:y,Body:p},success:function(e){r.show("SMS sent successfully!")},error:function(e){r.show("Failed to send SMS: "+e)}});c.byId("_IDGendfgdInput1").setValue("");c.byId("_IDGexgrgnInput2").setValue("");c.byId("idasgredhmeInput").setValue("");c.byId("idasgredhmeIn0075put").setValue("");c.confirmDialog.close();const w=new n("Slotnumbers",i.EQ,m);o.read("/ZPARKING_SLOTS_SSet",{filters:[w],success:function(e,t){if(S===l){o.update(`/ZPARKING_SLOTS_SSet('${m}')`,{Status:"RESERVED"})}},error:function(e){r.show("Failed to read slots")}})},error:async function(e){r.show("Failed to read slots")}})}},error:function(){}})}else{V.read("/ZPARKING_RESERVE_SSet",{filters:[_,D],success:async function(e,t){if(e.results.length>0){o.information("A slot not available on selected date")}else{V.update(`/ZPARKING_RESERVE_SSet('${y}')`,p,{success:async function(e,t){var s=0;var o=c.getView().getModel("ModelV2");o.read("/ZPARKING_RESERVE_SSet",{success:function(e){e.results.forEach(e=>{if(e.Reservedslot===""){s=s+1}});c.getView().byId("idbadghqwe").setValue(s)},error:function(e){}});const d=a.twilio.accountSid;const b=a.twilio.authToken;const v=`+91${g}`;const y="+15856485867";const p=`Hi ${u} a Slot number ${I} is reserved on your vehicle number ${h} \nVendor name: ${f}. \nThank You,\nVishal Parking Management`;const V=`https://api.twilio.com/2010-04-01/Accounts/${d}/Messages.json`;$.ajax({url:V,type:"POST",headers:{Authorization:"Basic "+btoa(d+":"+b)},data:{To:v,From:y,Body:p},success:function(e){r.show("SMS sent successfully!")},error:function(e){r.show("Failed to send SMS: "+e)}});c.byId("_IDGendfgdInput1").setValue("");c.byId("_IDGexgrgnInput2").setValue("");c.byId("idasgredhmeInput").setValue("");c.byId("idasgredhmeIn0075put").setValue("");c.confirmDialog.close();const w=new n("Slotnumbers",i.EQ,m);o.read("/ZPARKING_SLOTS_SSet",{filters:[w],success:function(e,t){if(S===l){o.update(`/ZPARKING_SLOTS_SSet('${m}')`,{Status:"RESERVED"})}},error:function(e){r.show("Failed to read slots")}})},error:async function(e){r.show("Failed to read slots")}})}},error:async function(e){r.show("Failed to read slots")}})}},onDeleteReservedPressToConfirm:async function(){const e=this.getView().byId("idReservedTable__").getSelectedItem();if(e){if(!this.ConfirmDeleteDialog){this.ConfirmDeleteDialog=await this.loadFragment("DeleteReserved")}this.ConfirmDeleteDialog.open()}else{o.information("Please Select one record")}},onCloseDeleteReservedPressToConfirm:function(){if(this.ConfirmDeleteDialog.isOpen()){this.ConfirmDeleteDialog.close()}},onDeleteReservedPress:function(){debugger;const e=this;let t=new Date;let s=t.getFullYear();let n=String(t.getMonth()+1).padStart(2,"0");let i=String(t.getDate()).padStart(2,"0");const r=`${s}-${n}-${i}`;const d=this.getView().getModel("ModelV2");const l=this.getView().byId("idReservedTable__").getSelectedItem();const c=l.getBindingContext().getObject().Drivermobile,u=l.getBindingContext().getObject().Drivername,g=l.getBindingContext().getObject().Reservedslot,h=l.getBindingContext().getObject().Reserveddate,f=l.getBindingContext().getObject().Uuid;d.remove(`/ZPARKING_RESERVE_SSet('${f}')`,{success:function(){o.information("Rejected and SMS will be sent");e.ConfirmDeleteDialog.close();const t=a.twilio.accountSid;const s=a.twilio.authToken;const n=`+91${c}`;const i="+15856485867";const l=`Hi ${u} We regret to inform you that \nCurrently we can not proceed with your reservation.\nyou are failed to come on reserved day\nThank you,\nVishal Parking Management`;const f=`https://api.twilio.com/2010-04-01/Accounts/${t}/Messages.json`;$.ajax({url:f,type:"POST",headers:{Authorization:"Basic "+btoa(t+":"+s)},data:{To:n,From:i,Body:l},success:function(e){sap.m.MessageToast.show("SMS sent successfully!")},error:function(e){sap.m.MessageToast.show("Failed to send SMS: "+e)}});if(h===r){d.update(`/ZPARKING_SLOTS_SSet('${g}')`,{Status:"AVAILABLE"},{success:function(){},error:function(){}})}},error:function(){}})},updateSoltsStatusbyDate:function(){debugger;const e=this;let t=new Date;let s=t.getFullYear();let r=String(t.getMonth()+1).padStart(2,"0");let a=String(t.getDate()).padStart(2,"0");const d=`${s}-${r}-${a}`;const l=this.getView().getModel("ModelV2");if(!l){console.log("error");return}l.read("/ZPARKING_RESERVE_SSet",{success:function(e,t){if(e.results.length>0){o.information("Hey you have reservations today");e.results.forEach(e=>{var t=e.Reserveddate;if(t===d){var s=e.Reservedslot;const t=new n("Slotnumbers",i.EQ,s);l.update(`/ZPARKING_SLOTS_SSet('${s}')`,{Status:"RESERVED"},{success:function(){},error:function(){}})}})}else{o.information("No Reservations found today")}},error:function(){}})},onAssignfromReservations:async function(){debugger;if(!this.ConfirmAssignDialog){this.ConfirmAssignDialog=await this.loadFragment("ConfirmAssign")}const e=this.getView().byId("idReservedTable__").getSelectedItem();if(e){const t=e.getBindingContext().getObject(),s=t.Drivername,n=t.Drivermobile,i=t.Vehiclenumber,r=t.Vendorname,o=t.Reservedslot;this.ConfirmAssignDialog.open();this.getView().byId("_IDGen__dfgdInput1").setValue(s);this.getView().byId("_IDGexgrsdfgnIn__put2").setValue(n);this.getView().byId("afidasgredhmeI__nput").setValue(i);this.getView().byId("idss__n0075put").setValue(r);this.getView().byId("_dhmeI__nput").setValue(o)}else{r.show("Please select a record")}},onCloseAssignConfirmDialog:function(){if(this.ConfirmAssignDialog.isOpen()){this.ConfirmAssignDialog.close()}},onConfirmAssignSlotPress:function(){debugger;var e=this;const t=this.getView().byId("idReservedTable__").getSelectedItem().getBindingContext().getObject();const s=this.getView().byId("idReservedTable__").getSelectedItem().getBindingContext(),d=t.Reserveddate,l=t.Uuid;var c=new Date;var u=c.getFullYear();var g=String(c.getMonth()+1).padStart(2,"0");var h=String(c.getDate()).padStart(2,"0");var f=String(c.getHours()).padStart(2,"0");var m=String(c.getMinutes()).padStart(2,"0");var S=String(c.getSeconds()).padStart(2,"0");var b=`${u}-${g}-${h} TIME ${f}:${m}:${S}`;var c=`${u}-${g}-${h}`;const v=this.getView(),I=v.byId("_IDGen__dfgdInput1").getValue().toUpperCase(),y=v.byId("_IDGexgrsdfgnIn__put2").getValue(),p=v.byId("afidasgredhmeI__nput").getValue().toUpperCase(),V=v.byId("idss__n0075put").getValue().toUpperCase(),w=v.byId("_IDGewertnSelect1").getSelectedKey().toUpperCase(),A=v.byId("_dhmeI__nput").getValue(),_=b;const D={Status:"NOT AVAILABLE",Assigneddrivername:I,Assigneddrivermobile:y,Assignedvehiclenumber:p,Assigneddeliverytype:w,VendorName:V,Assignedcheckintime:_};var x=this.getView().getModel("ModelV2");var R=true;if(!I||I.length<3||!/^[a-zA-Z\s]+$/.test(I)){v.byId("_IDGen__dfgdInput1").setValueState("Error");v.byId("_IDGen__dfgdInput1").setValueStateText("Name Must Contain 3 Characters (A-Z or a-z)");R=false}else{v.byId("_IDGen__dfgdInput1").setValueState("None")}if(!y||y.length!==10||!/^\d+$/.test(y)){v.byId("_IDGexgrsdfgnIn__put2").setValueState("Error");v.byId("_IDGexgrsdfgnIn__put2").setValueStateText("Mobile number must be a 10-digit numeric value");R=false}else{v.byId("_IDGexgrsdfgnIn__put2").setValueState("None")}if(!p||!/^[A-Za-z]{2}\d{2}[A-Za-z]{2}\d{4}$/.test(p)){v.byId("afidasgredhmeI__nput").setValueState("Error");v.byId("afidasgredhmeI__nput").setValueStateText("Vehicle number should follow this pattern AP12BG1234");R=false}else{v.byId("afidasgredhmeI__nput").setValueState("None")}if(!V||V.length<3||!/^[a-zA-Z\s]+$/.test(V)){v.byId("idss__n0075put").setValueState("Error");v.byId("idss__n0075put").setValueStateText("Vendor Name Must Contain 3 Characters (A-Z or a-z)");R=false}else{v.byId("idss__n0075put").setValueState("None")}if(!w||w==="SELECT"){v.byId("_IDGewertnSelect1").setValueState("Error");v.byId("_IDGewertnSelect1").setValueStateText("Please select atleast one option");R=false}else{v.byId("_IDGewertnSelect1").setValueState("None")}if(!A){v.byId("_dhmeI__nput").setValueState("Error");R=false}else{v.byId("_dhmeI__nput").setValueState("None")}if(!R){r.show("Please enter correct data");return}else{if(d===c){const t=new n("Assignedvehiclenumber",i.EQ,p);x.read("/ZPARKING_SLOTS_SSet",{filters:[t],success:function(t,s){if(t.results.length===0){x.update(`/ZPARKING_SLOTS_SSet('${A}')`,D,{success:async function(t,s){x.refresh(true);const n=a.twilio.accountSid;const i=a.twilio.authToken;const d=`+91${y}`;const c="+15856485867";const b=`Hi ${I} a Slot number ${A} is alloted to you vehicle number ${p} \nVendor name: ${V}. \nThank You,\nVishal Parking Management.`;const v=`https://api.twilio.com/2010-04-01/Accounts/${n}/Messages.json`;$.ajax({url:v,type:"POST",async:true,headers:{Authorization:"Basic "+btoa(n+":"+i)},data:{To:d,From:c,Body:b},success:function(e){r.show("if number exists SMS will be sent!")},error:function(e){r.show("Failed to send SMS")}});function _(e,t="en-US"){if("speechSynthesis"in window){var s=new SpeechSynthesisUtterance(e);s.pitch=1;s.rate=.75;s.volume=1;s.lang=t;debugger;window.speechSynthesis.speak(s)}else{console.log("Sorry, your browser does not support the Web Speech API.")}}_(`कृपया ध्यान दें। वाहन नंबर ${p} को स्लॉट नंबर ${A} द्वारा आवंटित किया गया है।`,"hi-IN");var D=e.byId("movingImage");D.setVisible(true);D.addStyleClass("animate");setTimeout(function(){D.setVisible(false)},7e3);if(!e.ReceiptDailog){e.ReceiptDailog=await e.loadFragment("Receipt")}e.ReceiptDailog.open();var R=A;e._generateBarcode(R);e.byId("textprint1").setText(p);e.byId("textprint5").setText(A);e.byId("textprint2").setText(I);e.byId("textprint3").setText(y);e.byId("textprint4").setText(w);e.byId("dfvtextprint1").setText(`Date: ${u}-${g}-${h} \nTIME: ${f}:${m}:${S}`);x.remove(`/ZPARKING_RESERVE_SSet('${l}')`,{success:function(t,s){r.show("allotment successful");e.getView().byId("_IDGen__dfgdInput1").setValue("");e.getView().byId("_IDGexgrsdfgnIn__put2").setValue("");e.getView().byId("afidasgredhmeI__nput").setValue("");e.getView().byId("_dhmeI__nput").setValue("");e.getView().byId("idss__n0075put").setValue("");e.ConfirmAssignDialog.close()},error:function(){o.show("Assigned successfully but failed to remove from reservations")}})},error:async function(e){o.show("Error while assigning the slot")}})}else{o.information("Vehicle already there in the yard")}},error:function(e,t){}})}else{o.information("You can assign current date reservations only")}}},onRefresh:function(){this.getView().getModel("ModelV2").refresh(true)},onRejectPress:async function(){const e=this.getView().byId("idReservationsTable").getSelectedItem();if(e){if(!this.confirmRejectDialog){this.confirmRejectDialog=await this.loadFragment("RejectConfirmation")}this.confirmRejectDialog.open()}else{o.information("Select one record to continue")}},onRejectCloseConfirmDialog:function(){if(this.confirmRejectDialog.isOpen()){this.confirmRejectDialog.close()}},onRejectReservePress:function(){debugger;const e=this;const t=this.getView().getModel("ModelV2");const s=this.getView().byId("idReservationsTable").getSelectedItem(),n=s.getBindingContext().getObject().Uuid,i=s.getBindingContext().getObject().Drivername,d=s.getBindingContext().getObject().Drivermobile;t.remove(`/ZPARKING_RESERVE_SSet('${n}')`,{success:function(){o.information("Rejected and SMS will be sent");const t=a.twilio.accountSid;const s=a.twilio.authToken;const n=`+91${d}`;const r="+15856485867";const l=`Hi ${i} We regret to inform you that\nCurrently we can not proceed with your reservation.\nThank you,\nVishal Parking Management`;const c=`https://api.twilio.com/2010-04-01/Accounts/${t}/Messages.json`;$.ajax({url:c,type:"POST",headers:{Authorization:"Basic "+btoa(t+":"+s)},data:{To:n,From:r,Body:l},success:function(e){sap.m.MessageToast.show("SMS sent successfully!")},error:function(e){sap.m.MessageToast.show("Failed to send SMS: "+e)}});e.confirmRejectDialog.close()},error:function(){r.show("Failed to reject")}})},oncloseDataonDataAnalysis:function(){if(this.oDataDialog.isOpen()){this.oDataDialog.close()}},onDataAnalysisPress:async function(){if(!this.oDataDialog){this.oDataDialog=await this.loadFragment("DataAnalytic")}this.oDataDialog.open();var e=this.getOwnerComponent().getModel("ModelV2");var s=this;e.refresh();this._setHistoryModel();var e=this.getView().getModel("ModelV2");e.read("/ZPARKING_SLOTS_SSet",{success:function(e){var n=e.results;var i=n.filter(e=>e.Status==="AVAILABLE").length;var r=n.filter(e=>e.Status==="NOT AVAILABLE").length;var o=n.filter(e=>e.Status==="RESERVED").length;var a={Items:[{Status:`Available-${i}`,Count:i},{Status:`Not Available-${r}`,Count:r},{Status:`Reserved-${o}`,Count:o}]};var d=new t;d.setData(a);s.getView().setModel(d,"ParkingLotModel")},error:function(e){console.error("Error while reading data:",e)}})},_setHistoryModel:function(){debugger;var e=this.getOwnerComponent().getModel("ModelV2");var t=this;var e=this.getView().getModel("ModelV2");e.read("/ZPARKING_HISTORYSet",{success:function(e){var s=e.results;var n=t._processHistoryData(s);var i=new sap.ui.model.json.JSONModel;i.setData(n);t.getView().setModel(i,"HistoryModel")},error:function(e){console.error("Error while reading data:",e)}})},_processHistoryData:function(e){var t={};e.forEach(function(e){var s=e.Checkintime.split(" TIME ");var n=new Date(s[0]);var i=n.getFullYear();var r=(n.getMonth()+1).toString().padStart(2,"0");var o=n.getDate().toString().padStart(2,"0");var a=`${i}-${r}-${o}`;if(!t[a]){t[a]={date:a,inwardCount:0,outwardCount:0,totalEntries:0}}if(e.Deliverytype==="INBOUND"){t[a].inwardCount+=1}else if(e.Deliverytype==="OUTBOUND"){t[a].outwardCount+=1}t[a].totalEntries=t[a].inwardCount+t[a].outwardCount});return{Items:Object.values(t)}},_generateBarcode:function(e){var t=this.byId("barcodeContainer");if(t){t.setContent('<svg id="barcode" ></svg>');setTimeout(function(){JsBarcode("#barcode",e,{displayValue:false})},0)}else{console.error("HTML control not found or not initialized.")}},onPrint:function(){var e=this.getView();var t=e.byId("idSimpleForm");var s=t.getDomRef();if(typeof domtoimage==="undefined"){console.error("domtoimage library is not loaded.");return}domtoimage.toPng(s).then(function(e){var t=new jsPDF({orientation:"landscape"});t.addImage(e,"JPEG",25,25,250,150);var s=t.output("blob");var n=URL.createObjectURL(s);var i=window.open(n,"_blank");i.onload=function(){i.print()}}).catch(function(e){console.error("Error:",e)})},onScanPress:function(e){debugger;const t=this;var s=new Date;var a=s.getFullYear();var l=s.getMonth()+1;var c=s.getDate();var u=s.getHours();var g=s.getMinutes();var h=s.getSeconds();var f=`${a}-${l}-${c} TIME ${u}:${g}:${h}`;var m=f;const S=this.getView().getModel("ModelV2");d.scan(function(e){if(e&&e.text){var s=e.text;debugger;const o=new n("Slotnumbers",i.EQ,s);S.read("/ZPARKING_SLOTS_SSet",{filters:[o],success:function(e){if(e.results.length>0&&e.results[0].Assignedvehiclenumber!==""){function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,s=e=="x"?t:t&3|8;return s.toString(16)})}const i=n();const o={Uuid:i,Drivername:e.results[0].Assigneddrivername,Drivermobile:e.results[0].Assigneddrivermobile,Vehiclenumber:e.results[0].Assignedvehiclenumber,Deliverytype:e.results[0].Assigneddeliverytype,Checkintime:e.results[0].Assignedcheckintime,Historyslotnumber:e.results[0].Slotnumbers,VendorName:e.results[0].VendorName,Checkouttime:m};const a={Status:"AVAILABLE",Assigneddrivername:"",Assigneddrivermobile:"",Assignedvehiclenumber:"",Assigneddeliverytype:"",VendorName:"",Assignedcheckintime:""};S.update(`/ZPARKING_SLOTS_SSet('${s}')`,a,{success:async function(e,s){var n=t.byId("movingImage2");n.setVisible(true);n.addStyleClass("animate");setTimeout(function(){n.setVisible(false)},7e3);S.create("/ZPARKING_HISTORYSet",o,{success:function(e,t){},error:function(e){r.show("Error"+e.message)}});t.getView().byId("idHistoryTable").getBinding("items").refresh();r.show("Vechicle Unassigned Successfully")},error:function(e){}})}else{r.show("Vehicle not found")}},error:function(e){r.show("error occured")}})}else{o.information("Something went wrong try again after some time")}}.bind(this),function(e){o.error("Barcode scanning failed: "+e)})},onSearchHistory:async function(e){debugger;var t=e.getParameter("newValue").trim();var s=this.byId("idHistoryTable");var n=s.getBinding("items");if(!n){console.error("Binding not found on the list");return}if(t===""){try{var i=this.getView().getModel("ModelV2");var r="/ZPARKING_HISTORYSet";var o=await new Promise((e,t)=>{i.read(r,{success:function(t){e(t.results)},error:function(e){console.error("Failed to fetch all data:",e);t(e)}})});var a=new sap.ui.model.json.JSONModel(o);s.setModel(a);s.bindItems({path:"/",template:s.getBindingInfo("items").template})}catch(e){console.error("Error fetching all data:",e)}return}var d=n.getContexts();var l=d.map(function(e){return e.getObject()});var c=l.filter(function(e){return e.Drivername&&e.Drivername.includes(t)||e.Drivermobile&&e.Drivermobile.includes(t)||e.Deliverytype&&e.Deliverytype.includes(t)||e.VendorName&&e.VendorName.includes(t)||e.Vehiclenumber&&e.Vehiclenumber.includes(t)||e.Historyslotnumber&&e.Historyslotnumber.includes(t)||e.Checkintime&&e.Checkintime.includes(t)||e.Checkouttime&&e.Checkouttime.includes(t)});var u=new sap.ui.model.json.JSONModel(c);s.setModel(u);s.bindItems({path:"/",template:s.getBindingInfo("items").template})},onSearch:async function(e){debugger;var t=e.getParameter("newValue").trim();var s=this.byId("idAssignedTable");var n=s.getBinding("items");if(!n){console.error("Binding not found on the list");return}if(t===""){try{var i=this.getView().getModel("ModelV2");var r="/ZPARKING_SLOTS_SSet";var o=await new Promise((e,t)=>{i.read(r,{filters:[new sap.ui.model.Filter("Status",sap.ui.model.FilterOperator.EQ,"NOT AVAILABLE")],success:function(t){e(t.results)},error:function(e){console.error("Failed to fetch all data:",e);t(e)}})});var a=new sap.ui.model.json.JSONModel(o);s.setModel(a);s.bindItems({path:"/",template:s.getBindingInfo("items").template})}catch(e){console.error("Error fetching all data:",e)}return}var d=n.getContexts();var l=d.map(function(e){return e.getObject()});var c=l.filter(function(e){if(e.Assignedvehiclenumber!==""){return e.Slotnumbers.includes(t)||e.Assigneddrivername.includes(t)||e.Assigneddrivermobile.includes(t)||e.Assigneddeliverytype.includes(t)||e.VendorName.includes(t)||e.Assignedvehiclenumber.includes(t)}});var u=new sap.ui.model.json.JSONModel(c);s.setModel(u);s.bindItems({path:"/",template:s.getBindingInfo("items").template})},onSortChange:function(e){var t=e.getParameter("selectedItem").getKey();var s=this.byId("idAllSlots");var n=s.getBinding("items");var i=[];if(t==="AVAILABLE"||t==="NOT AVAILABLE"||t==="RESERVED"){i.push(new sap.ui.model.Filter("Status",sap.ui.model.FilterOperator.EQ,t))}n.filter(i)}})});
//# sourceMappingURL=HomeView.controller.js.map